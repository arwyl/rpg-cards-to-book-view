<!doctype html>

<html lang="en" class="h-100">

<head>
  <meta charset="utf-8">

  <title>Rpg cards to book view</title>
  <meta name="description" content="Rpg cards to book view">
  <meta name="author" content="arwyl">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet"
    crossorigin="anonymous">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

  <link href="css/fonts.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
</head>

<body class="d-flex flex-column h-100">
  <main class="flex-shrink-0" id="app">
    <div class="container">
      <div class="nonprintable">
        <h2> rpg-cards-to-book-view</h2>
        <br />

        <div class="p-3 mb-2 bg-info text-dark">
          Load any number of .json files with arrays of <a href="https://crobi.github.io/rpg-cards/">rpg cards</a> and
          press Print.
          <br />
          You can reorder cards anyway you want by dragging them or clicking up and down arrows to the left of card
          title.
        </div>

        <p>Loaded cards: <span id="span-count">{{cards.length}}</span></p>

        <label>Sorting</label>
        <div class="d-flex d-flex-row">
          <div class="p-2">
            <select class="form-control" v-model="sorting.by" @change="sorting.byElement = 'subtitle'">
              <option value="title">Title</option>
              <option value="spellLevel">Spell level (experimental)</option>
              <option value="element">Element</option>
              <option value="firstTag">First tag name</option>
            </select>
          </div>
          <div class="p-2" v-if="sorting.by === 'element'" @change="sorting.propertyName = ''">
            <select class="form-control" v-model="sorting.byElement">
              <option value="subtitle">Subtitle</option>
              <option value="property">First property with name</option>
            </select>
          </div>
          <div class="p-2" v-if="sorting.byElement === 'property'">
            <input class="form-control" type="text" v-model="sorting.propertyName" placeholder="Enter property name" />
          </div>
          <div class="p-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="cb-sortDesc" v-model="sorting.desc">
              <label class="form-check-label" for="cb-sortDesc">
                Descending
              </label>
            </div>
          </div>
          <div class="p-2">
            <button class="btn btn-primary" type="button" @click="sort">Sort</button>
          </div>
        </div>

        <div class="d-flex d-flex-row">
          <div class="p-2">
            <button class="btn btn-primary" type="button" @click="openFileDialog">Load from json files</button>
          </div>
          <div class="p-2">
            <button class="btn btn-primary" type="button" @click="download">Save to file</button>
          </div>
          <div class="p-2">
            <button class="btn btn-danger" type="button" @click="clear">Clear cards</button>
          </div>
          <div class="p-2">
            <button class="btn btn-success" type="button" @click="print">Print</button>
          </div>
          <div class="p-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="cb-useSimplifiedView"
                v-model="useSimplifiedView">
              <label class="form-check-label" for="cb-useSimplifiedView">
                Use simplified view
              </label>
            </div>
          </div>
        </div>

        <form style="display:none">
          <input type="file" id="file-load" name="files[]" multiple accept="application/JSON" @change="load" />
        </form>
        <hr />
      </div>

      <div>
        <draggable :list="cards" @change="store" drag-class="rpg-card-drag">
          <div v-for="(card, index) in cards" class="rpg-card" :class="{ 'simple-view': useSimplifiedView }"
            :key="card.title">
            <div class="d-flex flex-row">
              <div class="card-moving nonprintable d-flex flex-column">
                <i class="card-move-up fas fa-chevron-up" :class="{ disabled: index === 0 }" @click="moveUp(index)"></i>
                <i class="card-move-down fas fa-chevron-down" :class="{ disabled: index === cards.length - 1 }"
                  @click="moveDown(index)"></i>
              </div>
              <div class="title"><strong>{{card.title}}</strong></div>
            </div>
            <template v-if="!useSimplifiedView">
              <template v-for="elem in card.elements">
                <div v-if="elem.name === 'subtitle'" class="subtitle"><em v-html="purify(elem.params[0])"></em></div>
                <div v-else-if="elem.name === 'property'"><strong v-html="purify(elem.params[0])"></strong>: <span
                    v-html="purify(elem.params[1])"></span>
                </div>
                <div v-else-if="elem.name === 'description'"><strong v-html="purify(elem.params[0])"></strong>:<span
                    v-html="purify(elem.params[1])"></span>
                </div>
                <div v-else-if="elem.name === 'section'" class="section">
                  <strong><u v-html="purify(elem.params[0])"></u></strong>: <span
                    v-html="purify(elem.params[1])"></span>
                </div>
                <div v-else-if="elem.name === 'text'" v-html="purify(elem.params[0])">
                </div>
                <ul v-else-if="elem.name === 'bullet'">
                  <li v-html="purify(elem.params[0])"></li>
                </ul>
                <div v-else-if="elem.name === 'picture'" class="picture"
                  :style="{ backgroundImage: getPictureUrl(elem), height: getPictureHeight(elem) + 'px' }"></div>
                <div v-else-if="elem.name === 'dndstats'" :set="stats = getDndStats(elem)" class="dndatsts-wrapper">
                  <table>
                    <tbody>
                      <tr>
                        <th>STR</th>
                        <th>DEX</th>
                        <th>CON</th>
                        <th>INT</th>
                        <th>WIS</th>
                        <th>CHA</th>
                      </tr>
                      <tr>
                        <td>{{stats.stats[0]}}&nbsp;({{stats.mods[0]}})</td>
                        <td>{{stats.stats[1]}}&nbsp;({{stats.mods[1]}})</td>
                        <td>{{stats.stats[2]}}&nbsp;({{stats.mods[2]}})</td>
                        <td>{{stats.stats[3]}}&nbsp;({{stats.mods[3]}})</td>
                        <td>{{stats.stats[4]}}&nbsp;({{stats.mods[4]}})</td>
                        <td>{{stats.stats[5]}}&nbsp;({{stats.mods[5]}})</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </template>
              <hr />
            </template>
          </div>
        </draggable>
      </div>
    </div>
  </main>
  <footer class="mt-auto py-3 bg-light nonprintable">
    <div class="container">
      <div>
        <a class="text-muted" href="https://github.com/arwyl/rpg-cards-to-book-view">github</a>
      </div>
    </div>
  </footer>

  <script type="module" src="js/app.js?v=2"></script>
</body>

</html>